<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Singapore MRT Line-Color Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
    body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f5f5f5;color:#222}
    h1,h2{margin:0.6em 0;text-align:center}
    .center{display:flex;justify-content:center;align-items:center}
    #setup,#playerNames,#game,#roundResult,#finalResult{
        max-width:500px;
        margin:2rem auto;
        padding:1.5rem 1.2rem 1.5rem 1.2rem;
        background:#fff;
        border-radius:10px;
        box-shadow:0 2px 8px rgba(0,0,0,0.13)
    }
    label{display:block;margin-bottom:0.5rem}
    input[type=number], input[type=text]{width:100%;padding:0.45rem;font-size:1rem;margin-bottom:1rem;border:1px solid #ccc;border-radius:4px}
    button{padding:0.7rem;font-size:1rem;border:none;border-radius:6px;cursor:pointer;background:#333;color:#fff;width:100%;transition:background 0.2s;}
    button:active{background:#555;}
    .colorBtnGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:0.5rem;margin: 0.7rem 0 0.5rem 0;}
    .colorBtn{height:48px;color:#fff;font-weight:bold;border:none;border-radius:6px;cursor:pointer;opacity:0.93;font-size:1.1rem;transition:transform 0.14s,box-shadow 0.14s;}
    .colorBtn.selected{outline:3px solid #000;opacity:1;transform:scale(1.08);box-shadow:0 0 10px 2px #2222;}
    .colorBtn:active{transform:scale(1.16);box-shadow:0 2px 20px 3px #8884;}
    .red{background:#d73027}
    .green{background:#1a9641}
    .blue{background:#4575b4}
    .yellow{background:#fdae61;color:#000}
    .purple{background:#8e44ad}
    .brown{background:#8d6e63}
    #stationName{font-size:1.4rem;margin:1rem 0;text-align:center;font-weight:bold}
    #stationClue{font-size:0.98rem;text-align:center;color:#555;margin-bottom:1rem}
    .hidden{display:none;}
    table{width:100%;border-collapse:collapse;margin-top:1rem}
    th,td{padding:0.55rem 0.3rem;border-bottom:1px solid #ccc;text-align:center}
    .fade-in{animation:fadeInAnim 0.4s;}
    .fade-out{animation:fadeOutAnim 0.35s;}
    @keyframes fadeInAnim{from{opacity:0}to{opacity:1}}
    @keyframes fadeOutAnim{from{opacity:1}to{opacity:0}}
    /* Correct answer circles */
    .colorCircle{
        display:inline-block;
        width:1.2em;height:1.2em;
        border-radius:50%;
        margin:0 0.2em 0 0;
        border:2px solid #999;vertical-align:middle;
    }
    .color-red{background:#d73027}
    .color-green{background:#1a9641}
    .color-blue{background:#4575b4}
    .color-yellow{background:#fdae61;border-color:#e1b232}
    .color-purple{background:#8e44ad}
    .color-brown{background:#8d6e63}
    .winnerRow{
        background:#e6ffe6 !important;
        font-weight:bold;
        box-shadow: 0 0 6px #99e299;
    }
    @media (max-width:600px){
      #setup,#playerNames,#game,#roundResult,#finalResult{padding:1.2rem 0.5rem;}
      .colorBtnGrid{gap:0.4rem;}
    }
</style>
</head>
<body>

<div id="setup">
    <h1>MRT Line-Color Quiz</h1>
    <label>How many players?
        <input type="number" id="numPlayers" min="1" max="8" value="2">
    </label>
    <label>How many rounds?
        <input type="number" id="numRounds" min="1" max="40" value="10">
    </label>
    <button id="beginNamesBtn">Next: Enter Names</button>
</div>

<div id="playerNames" class="hidden">
    <h2>Player Names</h2>
    <form id="playerNamesForm"></form>
    <button id="startBtn">Start Game</button>
</div>

<div id="game" class="hidden">
    <h2 id="roundHeader"></h2>
    <div id="playerTurn" class="center" style="font-weight:bold;"></div>
    <div id="stationName"></div>
    <div id="stationClue"></div>
    <div id="colorButtons" class="colorBtnGrid"></div>
    <button id="lockBtn" disabled>Lock In &amp; Pass Device</button>
</div>

<div id="roundResult" class="hidden">
    <h2>Round Result</h2>
    <div id="correctAnswer"></div>
    <table id="scoreTable"></table>
    <button id="nextRoundBtn">Next Round</button>
</div>

<div id="finalResult" class="hidden">
    <h2>Final Scores</h2>
    <table id="finalScoreTable"></table>
    <button onclick="location.reload()">Play Again</button>
</div>

<script>
// All lines: North South (red), East West (green), North East (purple), Circle (yellow), Downtown (blue), Thomson-East Coast (brown)
const stations = [
{name:"Jurong East",lines:["red","green"]},{name:"Bukit Batok",lines:["red"]},{name:"Bukit Gombak",lines:["red"]},{name:"Choa Chu Kang",lines:["red"]},{name:"Yew Tee",lines:["red"]},{name:"Kranji",lines:["red"]},{name:"Marsiling",lines:["red"]},{name:"Woodlands",lines:["red","brown"]},{name:"Admiralty",lines:["red"]},{name:"Sembawang",lines:["red"]},{name:"Canberra",lines:["red"]},{name:"Yishun",lines:["red"]},{name:"Khatib",lines:["red"]},{name:"Yio Chu Kang",lines:["red"]},{name:"Ang Mo Kio",lines:["red"]},{name:"Bishan",lines:["red","yellow"]},{name:"Braddell",lines:["red"]},{name:"Toa Payoh",lines:["red"]},{name:"Novena",lines:["red"]},{name:"Newton",lines:["red","blue"]},{name:"Orchard",lines:["red","brown"]},{name:"Somerset",lines:["red"]},{name:"Dhoby Ghaut",lines:["red","purple","yellow"]},{name:"City Hall",lines:["red","green"]},{name:"Raffles Place",lines:["red","green"]},{name:"Marina Bay",lines:["red","yellow","brown"]},{name:"Marina South Pier",lines:["red"]},
{name:"Tuas Link",lines:["green"]},{name:"Tuas West Road",lines:["green"]},{name:"Tuas Crescent",lines:["green"]},{name:"Gul Circle",lines:["green"]},{name:"Joo Koon",lines:["green"]},{name:"Pioneer",lines:["green"]},{name:"Boon Lay",lines:["green"]},{name:"Lakeside",lines:["green"]},{name:"Chinese Garden",lines:["green"]},{name:"Clementi",lines:["green"]},{name:"Dover",lines:["green"]},{name:"Buona Vista",lines:["green","yellow"]},{name:"Commonwealth",lines:["green"]},{name:"Queenstown",lines:["green"]},{name:"Redhill",lines:["green"]},{name:"Tiong Bahru",lines:["green"]},{name:"Outram Park",lines:["green","purple","brown"]},{name:"Tanjong Pagar",lines:["green"]},{name:"Bugis",lines:["green","blue"]},{name:"Lavender",lines:["green"]},{name:"Kallang",lines:["green"]},{name:"Aljunied",lines:["green"]},{name:"Paya Lebar",lines:["green","yellow"]},{name:"Eunos",lines:["green"]},{name:"Kembangan",lines:["green"]},{name:"Bedok",lines:["green"]},{name:"Tanah Merah",lines:["green"]},{name:"Expo",lines:["green","blue"]},{name:"Changi Airport",lines:["green"]},{name:"Simei",lines:["green"]},{name:"Tampines",lines:["green","blue"]},{name:"Pasir Ris",lines:["green"]},
{name:"HarbourFront",lines:["purple","yellow"]},{name:"Chinatown",lines:["purple","blue"]},{name:"Clarke Quay",lines:["purple"]},{name:"Little India",lines:["purple","blue"]},{name:"Farrer Park",lines:["purple"]},{name:"Boon Keng",lines:["purple"]},{name:"Potong Pasir",lines:["purple"]},{name:"Woodleigh",lines:["purple"]},{name:"Serangoon",lines:["purple","yellow"]},{name:"Kovan",lines:["purple"]},{name:"Hougang",lines:["purple"]},{name:"Buangkok",lines:["purple"]},{name:"Sengkang",lines:["purple"]},{name:"Punggol",lines:["purple"]},{name:"Outram Park",lines:["purple","green","brown"]},{name:"Dhoby Ghaut",lines:["purple","red","yellow"]},
{name:"Bras Basah",lines:["yellow"]},{name:"Esplanade",lines:["yellow"]},{name:"Promenade",lines:["yellow","blue"]},{name:"Nicoll Highway",lines:["yellow"]},{name:"Stadium",lines:["yellow"]},{name:"Mountbatten",lines:["yellow"]},{name:"Dakota",lines:["yellow"]},{name:"MacPherson",lines:["yellow","blue"]},{name:"Tai Seng",lines:["yellow"]},{name:"Bartley",lines:["yellow"]},{name:"Lorong Chuan",lines:["yellow"]},{name:"Marymount",lines:["yellow"]},{name:"Caldecott",lines:["yellow","brown"]},{name:"Botanic Gardens",lines:["yellow","blue"]},{name:"Farrer Road",lines:["yellow"]},{name:"Holland Village",lines:["yellow"]},{name:"one-north",lines:["yellow"]},{name:"Kent Ridge",lines:["yellow"]},{name:"Haw Par Villa",lines:["yellow"]},{name:"Pasir Panjang",lines:["yellow"]},{name:"Labrador Park",lines:["yellow"]},{name:"Telok Blangah",lines:["yellow"]},{name:"HarbourFront",lines:["yellow","purple"]},{name:"Buona Vista",lines:["yellow","green"]},{name:"Bishan",lines:["yellow","red"]},{name:"Serangoon",lines:["yellow","purple"]},{name:"Dhoby Ghaut",lines:["yellow","red","purple"]},{name:"Paya Lebar",lines:["yellow","green"]},
{name:"Bukit Panjang",lines:["blue"]},{name:"Cashew",lines:["blue"]},{name:"Hillview",lines:["blue"]},{name:"Beauty World",lines:["blue"]},{name:"King Albert Park",lines:["blue"]},{name:"Sixth Avenue",lines:["blue"]},{name:"Tan Kah Kee",lines:["blue"]},{name:"Stevens",lines:["blue","brown"]},{name:"Newton",lines:["blue","red"]},{name:"Rochor",lines:["blue"]},{name:"Bugis",lines:["blue","green"]},{name:"Promenade",lines:["blue","yellow"]},{name:"Bayfront",lines:["blue","yellow"]},{name:"Downtown",lines:["blue"]},{name:"Telok Ayer",lines:["blue"]},{name:"Chinatown",lines:["blue","purple"]},{name:"Fort Canning",lines:["blue"]},{name:"Bencoolen",lines:["blue"]},{name:"Jalan Besar",lines:["blue"]},{name:"Bendemeer",lines:["blue"]},{name:"Geylang Bahru",lines:["blue"]},{name:"Mattar",lines:["blue"]},{name:"MacPherson",lines:["blue","yellow"]},{name:"Ubi",lines:["blue"]},{name:"Kaki Bukit",lines:["blue"]},{name:"Bedok North",lines:["blue"]},{name:"Bedok Reservoir",lines:["blue"]},{name:"Tampines West",lines:["blue"]},{name:"Tampines",lines:["blue","green"]},{name:"Tampines East",lines:["blue"]},{name:"Upper Changi",lines:["blue"]},{name:"Expo",lines:["blue","green"]},{name:"Little India",lines:["blue","purple"]},
{name:"Woodlands North",lines:["brown"]},{name:"Woodlands",lines:["brown","red"]},{name:"Woodlands South",lines:["brown"]},{name:"Springleaf",lines:["brown"]},{name:"Lentor",lines:["brown"]},{name:"Mayflower",lines:["brown"]},{name:"Bright Hill",lines:["brown"]},{name:"Upper Thomson",lines:["brown"]},{name:"Caldecott",lines:["brown","yellow"]},{name:"Mount Pleasant",lines:["brown"]},{name:"Stevens",lines:["brown","blue"]},{name:"Napier",lines:["brown"]},{name:"Orchard Boulevard",lines:["brown"]},{name:"Orchard",lines:["brown","red"]},{name:"Great World",lines:["brown"]},{name:"Havelock",lines:["brown"]},{name:"Outram Park",lines:["brown","green","purple"]},{name:"Maxwell",lines:["brown"]},{name:"Shenton Way",lines:["brown"]},{name:"Marina Bay",lines:["brown","red","yellow"]}
];

const colorDefs=[
  {id:'red',label:'Red',class:'red'},
  {id:'green',label:'Green',class:'green'},
  {id:'blue',label:'Blue',class:'blue'},
  {id:'yellow',label:'Yellow',class:'yellow'},
  {id:'purple',label:'Purple',class:'purple'},
  {id:'brown',label:'Brown',class:'brown'}
];

let numPlayers=2,numRounds=10,currentRound=0,players=[],answersPerRound=[],stationPool=[];
const setupEl=document.getElementById('setup');
const playerNamesEl=document.getElementById('playerNames');
const playerNamesForm=document.getElementById('playerNamesForm');
const gameEl=document.getElementById('game');
const roundResEl=document.getElementById('roundResult');
const finalResEl=document.getElementById('finalResult');
const colorButtonsEl=document.getElementById('colorButtons');

let _fadeTimeout = null;

// Build color buttons in two rows
const buttonOrder = [
  ['red','green','blue'],
  ['yellow','purple','brown']
];
colorButtonsEl.innerHTML = '';
buttonOrder.forEach(row=>{
  row.forEach(col=>{
    const c = colorDefs.find(cc=>cc.id===col);
    const btn=document.createElement('button');
    btn.className='colorBtn '+c.class;
    btn.textContent=c.label;
    btn.dataset.color=c.id;
    btn.type = "button";
    btn.onclick=()=>{
      btn.classList.toggle('selected');
      // Enable lock only if at least 1 selected
      document.getElementById('lockBtn').disabled = colorButtonsEl.querySelectorAll('.selected').length===0;
    };
    colorButtonsEl.appendChild(btn);
  });
});

// Step 1: Setup - enter # players/# rounds
document.getElementById('beginNamesBtn').onclick=()=>{
  numPlayers=parseInt(document.getElementById('numPlayers').value);
  numRounds=parseInt(document.getElementById('numRounds').value);
  if(numPlayers<1||numRounds<1)return;
  playerNamesForm.innerHTML='';
  for(let i=0;i<numPlayers;i++){
    playerNamesForm.innerHTML+=`
      <label>Player ${i+1} Name:
        <input type="text" name="pname${i+1}" id="pname${i+1}" maxlength="18" value="Player ${i+1}" required>
      </label>`;
  }
  setupEl.classList.add('hidden');
  playerNamesEl.classList.remove('hidden');
};

// Step 2: Enter names
document.getElementById('startBtn').onclick=()=>{
  players=[];
  for(let i=0;i<numPlayers;i++){
    let v = document.getElementById('pname'+(i+1)).value.trim();
    if(!v) v = "Player "+(i+1);
    players.push({name:v,score:0});
  }
  stationPool=[...stations];
  currentRound=0;
  playerNamesEl.classList.add('hidden');
  gameEl.classList.remove('hidden');
  startNextRound();
};

function startNextRound(){
  currentRound++;
  if(currentRound>numRounds){showFinal();return;}
  if(stationPool.length===0)stationPool=[...stations];
  const idx=Math.floor(Math.random()*stationPool.length);
  const station=stationPool.splice(idx,1)[0];
  gameEl.dataset.correct=JSON.stringify(station.lines.sort());
  document.getElementById('stationName').textContent=station.name;
  document.getElementById('stationClue').textContent=station.lines.length===1?
      'Single-line station (1 line)':
      `Interchange station (${station.lines.length} lines)`;
  document.getElementById('roundHeader').textContent=`Round ${currentRound} of ${numRounds}`;
  answersPerRound=[];
  nextPlayerTurn(0, false);
}

function nextPlayerTurn(idx, doFade=true){
  if(idx === 0) doFade = false;
  if(doFade){
    fadeOutIn(gameEl,()=>{
      clearSelections();
      document.getElementById('playerTurn').textContent=
          players[idx].name+' – select line color(s)';
      gameEl.dataset.currentPlayer=idx;
      document.getElementById('lockBtn').disabled = true;
    });
  }else{
    clearSelections();
    document.getElementById('playerTurn').textContent=
      players[idx].name+' – select line color(s)';
    gameEl.dataset.currentPlayer=idx;
    document.getElementById('lockBtn').disabled = true;
  }
}

function clearSelections(){
  colorButtonsEl.querySelectorAll('.colorBtn').forEach(b=>b.classList.remove('selected'));
}

document.getElementById('lockBtn').onclick=()=>{
  const selections=[...colorButtonsEl.querySelectorAll('.selected')].map(b=>b.dataset.color).sort();
  const idx=parseInt(gameEl.dataset.currentPlayer);
  answersPerRound[idx]=selections;
  if(idx+1<numPlayers){
    nextPlayerTurn(idx+1, true);
  }else{
    fadeOutIn(gameEl,showRoundResult);
  }
};

function fadeOutIn(el, cb){
  if(_fadeTimeout) clearTimeout(_fadeTimeout);
  el.classList.remove('fade-in');
  el.classList.add('fade-out');
  _fadeTimeout=setTimeout(()=>{
    el.classList.remove('fade-out');
    cb&&cb();
    el.classList.add('fade-in');
    _fadeTimeout=setTimeout(()=>el.classList.remove('fade-in'),450);
  },350);
}

function showRoundResult(){
  const correct=JSON.parse(gameEl.dataset.correct);
  players.forEach((p,i)=>{
    if(JSON.stringify(answersPerRound[i]||[])===JSON.stringify(correct))p.score++;
  });
  // Correct line display: colored circles and text
  const lineCircles = correct.map(clr=>`<span class="colorCircle color-${clr}"></span>`).join('');
  document.getElementById('correctAnswer').innerHTML=
    'Correct line(s): '+lineCircles+'<span style="margin-left:0.7em;font-size:1.07em;">'+correct.join(', ')+'</span>';

  // Highlight winners of round
  const table=document.getElementById('scoreTable');
  table.innerHTML='<tr><th>Player</th><th>Your Answer</th><th>Score</th></tr>';
  players.forEach((p,i)=>{
    const isWinner = JSON.stringify(answersPerRound[i]||[])===JSON.stringify(correct);
    let row=document.createElement('tr');
    if(isWinner) row.className='winnerRow';
    // Render answer with color circles
    let ansHtml = '';
    if ((answersPerRound[i]||[]).length){
      ansHtml = answersPerRound[i].map(clr=>`<span class="colorCircle color-${clr}"></span>`).join('');
      ansHtml += '<span style="margin-left:0.4em;">'+(answersPerRound[i]||[]).join(', ')+'</span>';
    }
    row.innerHTML=`<td>${p.name}</td><td>${ansHtml||'-'}</td><td>${p.score}</td>`;
    table.appendChild(row);
  });
  gameEl.classList.add('hidden');
  roundResEl.classList.remove('hidden');
  roundResEl.classList.add('fade-in');
  setTimeout(()=>roundResEl.classList.remove('fade-in'),500);
}

document.getElementById('nextRoundBtn').onclick=()=>{
  roundResEl.classList.add('hidden');
  gameEl.classList.remove('hidden');
  gameEl.classList.add('fade-in');
  setTimeout(()=>gameEl.classList.remove('fade-in'),500);
  startNextRound();
};

function showFinal(){
  gameEl.classList.add('hidden');
  roundResEl.classList.add('hidden');
  const fTable=document.getElementById('finalScoreTable');
  fTable.innerHTML='<tr><th>Player</th><th>Final Score</th></tr>';
  players.sort((a,b)=>b.score-a.score).forEach(p=>{
    const row=document.createElement('tr');
    row.innerHTML=`<td>${p.name}</td><td>${p.score}</td>`;
    fTable.appendChild(row);
  });
  finalResEl.classList.remove('hidden');
}
</script>
</body>
</html>
